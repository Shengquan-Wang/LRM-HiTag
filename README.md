# LRM-HiTag
The precise analysis of three-dimensional chromatin conformation and epigenetic modifications is a key scientific issue for revealing the regulatory mechanism of gene expression and genomic functions. The traditional second-generation sequencing technology has bottlenecks such as blind spots in structural variation detection, insufficient analysis of complex regulatory regions, and lack of information at the haplotype level due to the limitation of read length. In recent years, third-generation sequencing technology has gradually emerged. Relying on its advantages of long-read sequencing and the convenience of directly detecting epigenetic modifications, it has provided new opportunities for genomics, epigenetics and three-dimensional genome research. With the rapid development of third-generation sequencing technology, many new technologies based on long-read sequencing have emerged one after another, such as NdOME -seq: Utilizing the multimodality of third-generation sequencing provides a new strategy for the analysis of gene regulatory landscapes; SAMOSA-Tag: The use of exogenous adenine methylation for the detection of chromatin accessibility has added a new channel.

Although these new technologies have made remarkable progress by using third-generation long-read sequencing, they are unable to obtain multi-dimensional information of the genome from one-dimensional, two-dimensional, three-dimensional to haplotypes simultaneously through a single experiment. In view of this, this study innovatively developed the RM-HitAG technology integrating long-read single-molecule sequencing and antibody-targeted labeling, achieving high-precision integrated analysis of multi-dimensional genomic characteristics.
# Dependencies
The codebase relies on the following dependancies (tested version provided in parentheses):
```
dorado
samtools
modkit
bedGraphToBigwig
bedtools
pore-c-py
modbam2bed
HiPore-C
juicertools
ngrml
```
# Discription of LRM-HiTag
LRM-HiTag pipline can automatically process the sequencing data generated by the LRM-HiTag experiment. Genomic data analysis starts from the pod5 file taken off the machine. DNA base sequence information is identified through basecalling. Meanwhile, the advantages of third-generation sequencing are utilized to directly obtain methylation epigenetic modification information. The genomic active regions were identified by using methylation information, and the three-dimensional chromatin interaction information was obtained by combining in situ chromatin conformation capture technology to construct the expression regulation map of the genomic active regions.
# Installation
Create a clean environment by conda
```
$ conda env create -f LRM-HiTag.yml
$ conda activate LRM-HiTag
```
**Install bedGraphToBigwig**
```
$ wget http://hgdownload.cse.ucsc.edu/admin/exe/linux.x86_64/bedGraphToBigWig
$ chmod +x bedGraphToBigWig
```
**Install dorado**

Find details in this way https://github.com/nanoporetech/dorado/

**Install HiPore-C**

Find details in this way https://github.com/zhengdafangyuan/HiPore-C

**Install modkit**

Find details in this way https://github.com/nanoporetech/modkit

**Install juicertools**

Find details in this way https://github.com/aidenlab/juicertools

**Install ngrml**

Find details in this way https://github.com/philres/ngmlr
# Run
**1.Calculate the sum of 6mA signals in the 500bp window of the genome**
Replace the following contents in the script according to your own environment path and the input file path.
```
#!/usr/bin/env/ nextflow
nextflow.enable.dsl = 2
pod5_dir = "pod5_pass/"
dorado_dir = "/user/home/app/dorado-version-linux-x64/bin"
model = "/path/to/model"
reference = "path/to/reference.fa"
enzyme = "MboI"
prefix = "sample-name"
```
Run the first script after confirming that the path is correct.
```
$ nextflow run 500bp-6mA-signal-sum.nf
```
**2.Identify the m6A get sequence**
Take the result file of the previous step as the input file and change the following information according to your operation requirements.
```
outFolder <- "./"
signalsumFile <- ""
sampleName <- ""
```
If you have an R environment, activate the R environment and then run the script.
```
$ conda activate R-environment
$ Rscript identify_6mAgetsequence.R
```
If you do not have an R environment, script commands can be run in RStudio or an interactive R environment.

**3.Construct the expression regulation map of the active region**
Replace the following contents in the script according to your own environment path and the input file path.
```
#!/usr/bin/env/ nextflow
nextflow.enable.dsl = 2
params.cutoff = the-cutoff-value-calculated-by-R
params.sample_id = "sample-name" 
params.input_bam = "${params.sample_id}.methylation.bam"
params.sum_file = "500bp.6mA.sum.txt"
params.combine_script = "combine-6mA-get.py"
```
Run the second script after confirming that the path is correct.
```
$ nextflow run interaction-of-6mA-get-sequence.nf
```
